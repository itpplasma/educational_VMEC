<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>VMEC: Educational VMEC</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js", "TeX/AMSmath.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
<script>
window.MathJax = {
  loader: {
    load: ['[tex]/color', '[tex]/cancel']
  },
  tex: {
      tags: "ams",
      packages: {'[+]': ['noerrors'],
                 '[+]': ['color'],
                 '[+]': ['verb'],
                 '[+]': ['cancel']
      }
      macros: { bm: ["{\\boldsymbol #1}",1]
      }
  }
};
</script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" id="MathJax-script"></script>
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.0.0/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">VMEC<span id="projectnumber">&#160;8.52</span>
   </div>
   <div id="projectbrief">3D Equilibrium solver with nested flux surfaces.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Educational VMEC </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README"></a> This is a heavily stripped-down version of the serial implementation of VMEC 8.52. It is forked from the <code>v251</code> branch of the <a href="https://github.com/PrincetonUniversity/STELLOPT">STELLOPT</a> repository.</p>
<p>The goal of this project is to have a version of VMEC which only computes the Stellarator MHD equilibrium and nothing more.</p>
<p>The <code>cmake</code> build system for stand-alone VMEC is borrowed from <a href="https://github.com/hiddenSymmetries/VMEC2000">hiddenSymmetries/VMEC2000</a> and from <a href="https://github.com/ORNL-Fusion/LIBSTELL">ORNL-Fusion/LIBSTELL</a>.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Building</h1>
<p>Required packages on Debian stable are: <code>cmake</code>, <code>gfortran</code>, <code>libnetcdff-dev</code>, <code>libblas-dev</code>, <code>liblapack-dev</code>, <code>libfftw3-dev</code></p>
<p>You need to download this repository and the included <code>json-fortran</code>. The easiest way to do this is via a recursive <code>git clone</code>:</p>
<div class="fragment"><div class="line">&gt; git clone --recursive https://github.com/jonathanschilling/educational_VMEC.git</div>
</div><!-- fragment --><p>Ignore warnings about missing access to <code>src/vac2</code> and <code>src/vac3</code>. After cloning, the <code>json-fortran</code> directory is somewhat messed up and you need to fix that:</p>
<div class="fragment"><div class="line">&gt; cd educational_VMEC/json-fortran</div>
<div class="line">&gt; git restore --staged .</div>
<div class="line">&gt; git checkout .</div>
<div class="line">&gt; cd ..</div>
</div><!-- fragment --><p>This is a fairly standard CMake setup, if you are used to it. Here is how it works:</p><ul>
<li>Create a directory <code>build</code> in the main folder: <code>mkdir build</code></li>
<li>Go into the <code>build</code> directory: <code>cd build</code></li>
<li>Run CMake: <code>cmake ..</code></li>
<li>Execute the actual build process: <code>make</code> (optional multi-threaded build: <code>make -j</code>)</li>
<li>The VMEC executable <code>xvmec</code> is then located in <code>build/bin</code> with respect to the main folder.</li>
</ul>
<h1><a class="anchor" id="autotoc_md2"></a>
Example Execution</h1>
<ul>
<li>Change into the <code>test</code> dir: <code>cd test</code></li>
<li>Run the <a href="https://princetonuniversity.github.io/FOCUS/notes/Coil_design_codes_benchmark.html#Equiblirium--">Solov'ev test case</a>: <code>../build/bin/xvmec input.solovev</code></li>
</ul>
<h1><a class="anchor" id="autotoc_md3"></a>
Debug Output</h1>
<p>The <a href="src/dbgout.f90"><code>dbgout</code></a> module allows to (optionally) write a bunch of data from within the code into separate JSON files. Writing these additional quantities is disabled by default and can be enabled by logical flags in the <code>INDATA</code> namelist. A full list of the available flags (ordered by module where they are used) is available in <a href="src/data/vmec_input.f90#L89">vmec_input.f90</a>. A folder named the same as the extension of the input file will be created. In there, subfolders named after each of the enabled <code>dump_*</code> flags will be created. For example, put <code>dump_forces=.true.</code> into <code>input.solovev</code> and the folder <code>solovev/forces/</code> will be created and JSON files will appear in there. In each of these subfolders, JSON files will be created according to the following naming scheme: <code>forces_&lt;ns&gt;_&lt;iteration&gt;_&lt;occurence&gt;.&lt;extension&gt;.json</code> where</p><ul>
<li><code>ns</code> is the number of flux surfaces of the respective multi-grid step,</li>
<li><code>iteration</code> is the iteration number printed to the screen and</li>
<li><code>occurence</code> is a linear counter used in case the respective quantities need to get dumped more than once in the respective context (e.g. before and after some important subroutine call)</li>
</ul>
<p>As a first start, I usually look at JSON files using the Firefox browser, which has a rather nice built-in JSON viewer. For plotting, I have written a Python utility <a href="test/plot_dbg_json.py"><code>plot_dbg_json.py</code></a>, which can plot the quantities from the JSON files produced by <code>educational_VMEC</code>.</p>
<p>Use it as follows:</p><ol type="1">
<li><p class="startli">to plot all quantities (at all flux surfaces) in a given JSON file:</p>
<div class="fragment"><div class="line">../../plot_dbg_json.py forces_00015_000001_01.test.vmec.json</div>
</div><!-- fragment --></li>
<li><p class="startli">the list of quantities to plot can be specified as follows (for quicker iterations, since plotting everything can take a while):</p>
<div class="fragment"><div class="line">../../plot_dbg_json.py forces_00015_000001_01.test.vmec.json --quantities ru12</div>
<div class="line">../../plot_dbg_json.py forces_00015_000001_01.test.vmec.json --quantities ru12 zu12</div>
</div><!-- fragment --></li>
<li><p class="startli">to plot a subset of flux surfaces (0-based indexing):</p>
<div class="fragment"><div class="line">../../plot_dbg_json.py forces_00015_000001_01.test.vmec.json --surfaces 6</div>
<div class="line">../../plot_dbg_json.py forces_00015_000001_01.test.vmec.json --surfaces 0 5 14</div>
</div><!-- fragment --></li>
<li><p class="startli">to plot a subset of quantities at a subset of surfaces:</p>
<div class="fragment"><div class="line">../../plot_dbg_json.py forces_00015_000001_01.test.vmec.json --quantities ru12 zu12 --surfaces 6 7</div>
</div><!-- fragment --></li>
</ol>
<h1><a class="anchor" id="autotoc_md4"></a>
External NESTOR</h1>
<p>The free-boundary part of VMEC is the Neumann Solver for Toroidal Systems (NESTOR). Its source code is in a separate folder <a href="src/NESTOR"><code>NESTOR</code></a>. The appropriate reference is <a href="https://doi.org/10.1016/0021-9991(86)90055-0">https://doi.org/10.1016/0021-9991(86)90055-0</a> .</p>
<p>This version of NESTOR can be run stand-alone. It reads its inputs from a netCDF file and writes its outputs into another netCDF file. The main executable of this stand-alone version of NESTOR is <a href="src/NESTOR/nestor_main.f90"><code>nestor_main.f90</code></a>. The input and output files are read and written in <a href="src/NESTOR/data/nestor_io.f90"><code>nestor_io.f90</code></a>.</p>
<p>This version of VMEC can be configured to dump the corresponding input and output files, but still run the compiled-in version of NESTOR. This is enabled via the logical flag <code>ldump_vacuum_ref</code> in <a href="src/funct3d.f90"><code>funct3d.f90</code></a>.</p>
<p>Also, an external NESTOR implementation can be called instead of using the compiled-in version of NESTOR. This is enabled via the logical flag <code>lexternal_nestor</code> in <a href="src/funct3d.f90"><code>funct3d.f90</code></a>. The corresponding system call to execute the external NESTOR implementation has to be specified in <code>nestor_executable</code> in <a href="src/funct3d.f90"><code>funct3d.f90</code></a>.</p>
<h1><a class="anchor" id="autotoc_md5"></a>
Angle Constraint</h1>
<p>The poloidal angle-like coordinate is a priori not uniquely defined and needs special care. The version of VMEC from the STELLOPT repo had essentially two options for this. They were alternatively compiled in via the preprocessor flag <code>_HBANGLE</code>.</p>
<ol type="1">
<li>The Hirshman-Breslau explicit spectrally optimized Fourier series (see <a href="https://doi.org/10.1063/1.872954">https://doi.org/10.1063/1.872954</a> for details) and</li>
<li>an unknown mixture of several constraints of the <code>m=1</code> Fourier coefficients (the logical <code>lconm1</code> is true for this constraint).</li>
</ol>
<p>By default, the <code>_HBANGLE</code> preprocessor flag is not active and thus, the "old" <code>m=1</code> constraint is active.</p>
<p>This version of VMEC has all preprocessor flags already expanded. It became clear that it is nevertheless useful to have at least a vague idea of what parts of the code are related to the angle constraint. Therefore, those parts of VMEC related to the <code>m=1</code>constraint are marked to start with</p>
<div class="fragment"><div class="line">! #ifndef _hbangle</div>
</div><!-- fragment --><p>and end with</p>
<div class="fragment"><div class="line">! #<span class="keyword">end </span>/* ndef _HBANGLE */</div>
</div><!-- fragment --><p>Note that the <a href="https://github.com/jonathanschilling/educational_VMEC/blob/master/vmec_info.md">original documentation</a> states: </p><blockquote class="doxtable">
<p>&zwj;THE POLOIDAL ANGLE IS DETERMINED BY MINIMIZING &lt;M&gt; = m**2 S(m) , WHERE S(m) = Rm**2 + Zm**2 . </p>
</blockquote>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Sep 5 2023 09:21:50 for VMEC by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
